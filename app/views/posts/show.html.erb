<h1 class="text-center mt-2">Show Page</h1>

<div class="container mt-4">
  <% if @post %>

    <!-- Edit and Delete Links -->
    <div class="row">
      <div class="col-lg-8 offset-lg-2">
      <div class="d-flex justify-content-between">
          <%= link_to 'Back to all posts', posts_path, class: 'btn btn-secondary' %>
          <% if can? :create, Post %>
            <%= link_to 'New Post', new_post_path, class: 'btn btn-primary' %>
          <% end %>
        </div>
        </br>
        <h3>Edit Post</h3>
        <% unless current_user.reader? %>
          <ul class="list-unstyled">
            <li>
              <%= link_to "Edit", edit_post_path(@post), class: 'btn btn-warning' %>
            </li>
            <li>
              <%= link_to "Delete", post_path(@post), method: :delete, data: { confirm: "Are you sure?" }, class: 'btn btn-danger' %>
            </li>
          </ul>
        <% end %>
      </div>
    </div>
    
    <!-- Title -->
    <div class=" col-lg-8 offset-lg-2">
        <h2 class="text-center"><%= @post.title %></h2>
        <p class="lead"><%= @post.body.gsub(/<[^>]*>/, '')%></p>
    </div>
    <!-- Post Images -->
        <% if @post.post_images.attached? %>
          <div class="row">
            <div class="col-lg-8 offset-lg-2">
              <h3>Images</h3>
              <% @post.post_images.each do |image| %>
                <div class="mb-3">
                  <%= image_tag image, class: 'img-fluid', style: "width: 100%; max-height: 400px; object-fit: cover;" %>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
    

    <!-- Comments Section -->
    <div class="row">
      <div class="col-lg-8 offset-lg-2">
        <h2>Comments</h2>
        <% @post.comments.each do |comment| %>
          <div class="card mb-3">
            <div class="card-body">
              <h5 class="card-title"><strong>Commenter:</strong> <%= comment.user.email.gsub(/@.*/, '') %></h5>
              <p class="card-text"><strong>Comment:</strong> <%= comment.body %></p>

              <% if comment.user == current_user || current_user.admin? || @post.user == current_user %>
                <div class="d-flex">
                  <%= link_to 'Edit', edit_post_comment_path(@post, comment), class: 'btn btn-info btn-sm mr-2' %>
                  <%= link_to 'Delete', post_comment_path(@post, comment), method: :delete, data: { confirm: 'Are you sure you want to delete this comment?' }, class: 'btn btn-danger btn-sm' %>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Add Comment Form -->
    <div class="row">
      <div class="col-lg-8 offset-lg-2">
        <h2>Add a comment:</h2>
        <%= form_with model: [@post, @post.comments.build] do |form| %>
          <div class="form-group">
            <%= form.label :body, class: 'form-label' %>
            <%= form.text_area :body, class: 'form-control', rows: 2 %>
          </div>
          <div class="form-group">
            <%= form.submit 'Submit', class: 'btn btn-success' %>
          </div>
        <% end %>
      </div>
    </div>
  <% else %>
    <p class="text-center">Post not found.</p>
    <%= link_to 'Back to all posts', posts_path, class: 'btn btn-secondary' %>
  <% end %>
</div>
