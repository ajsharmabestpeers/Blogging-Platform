<h1>Show Page</h1>
<% if @post %>
  <h1><%= @post.title %></h1>
  <p><%= @post.body %></p>
  <%= link_to 'Back to all posts', posts_path %>
<% else %>
  <p>Post not found.</p>
  <%= link_to 'Back to all posts', posts_path %>
<% end %>

<h1>Edit Post</h1>
<ul>
  <% if @post %>
    <li><%= link_to "Edit", edit_post_path(@post) %></li>
  <% else %>
    <li>No post found to edit.</li>
  <% end %>
  <li><%= link_to "Delete", post_path(@post), data: { turbo_method: :delete, turbo_confirm: "Are you sure?" } %></li>
</ul>

<% if can? :create, Post %>
  <%= link_to 'New Post', new_post_path %>
  
<% end %>

<h2>Comments</h2>
<% @post.comments.each do |comment| %>
  <p>
    <strong>Commenter:</strong>
    <%= comment.user.email.gsub(/@.*/, '')%>
  </p>
  <p>
    <strong>Comment:</strong>
    <%= comment.body %>
  </p>

  <% if comment.user == current_user %>
    <%= link_to 'Delete', post_comment_path(@post, comment), method: :delete, data: { confirm: 'Are you sure you want to delete this comment?' } %>
    <%= link_to 'Edit',   edit_post_comment_path(@post, comment) %>
    <% end %>
     
<% end %>

<h2>Add a comment:</h2>
<%= form_with model: [ @post, @post.comments.build ] do |form| %>
  <p>
    <%= form.label :body %><br>
    <%= form.text_area :body %>
  </p>
  <p>
    <%= form.submit %>
  </p>
<% end %>
